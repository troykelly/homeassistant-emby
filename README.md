# Emby for Home Assistant

[![hacs-badge](https://img.shields.io/badge/HACS-Custom-orange.svg?style=for-the-badge&logo=home-assistant&logoColor=white)](https://hacs.xyz/)

Integrate your **Emby** media server with **Home Assistant** ‚Äì browse your entire library, control playback on any Emby client, trigger rich automations and surface real-time session information in your dashboards.

---

## ‚ú®  What does the integration provide?

‚Ä¢  **Media Players for every Emby client**  ‚Äì a `media_player` entity is created for each active session so you can play, pause, seek, change volume and read state from Home Assistant just like any other player.

‚Ä¢  **Browse Media**  ‚Äì visually navigate Movies, TV, Music and more inside Home Assistant‚Äôs ‚ÄúBrowse media‚Äù dialog complete with artwork.

‚Ä¢  **Universal `media_player.play_media` support**  ‚Äì pass a title, Emby **ItemId** or a deep-link generated by the browse dialog and the integration will locate and play it, with full support for enqueueing, positional starts and announcements.

‚Ä¢  **Assist / voice control**  ‚Äì ‚ÄúHey Assistant, *play The Lord of the Rings in the Lounge*‚Äù just works because Assist is routed through the `media_player.play_media` service.

‚Ä¢  **Automation friendly**  ‚Äì build scripts that react to play state changes, automatically queue the next episode when credits roll, resume music after TTS interruptions and anything else your creativity allows.

---

## üõ†  Installation Options

You can install the integration in three different ways.  **HACS** is strongly recommended because it handles updates for you, but a manual ZIP install is also provided.

1.  **HACS (official store ‚Äì coming soon)**
    1. Open *HACS ‚Üí Integrations* and click **Explore & Download Repositories**.
    2. Search for **‚ÄúEmby for Home Assistant‚Äù** and hit **Download**.
    3. Restart Home Assistant when prompted.

2.  **HACS ‚Äì Custom Repository (available today)**
    1. Ensure HACS is installed and working.
    2. Navigate to *HACS ‚Üí Integrations ‚Üí ‚ãÆ ‚Üí Custom repositories*.
    3. Enter the repository URL `https://github.com/troykelly/homeassistant-emby` and set **Category** to *Integration*.
    4. Click **Add**, then find **Emby for Home Assistant** in the integration list and **Download** it.
    5. Restart Home Assistant.

3.  **Manual ZIP Install**
    1. Download the latest release archive from the [GitHub releases page](https://github.com/troykelly/homeassistant-emby/releases).
    2. Extract the `custom_components/embymedia` directory from the ZIP.
    3. Copy that directory into the `<config>/custom_components/` folder of your Home Assistant instance (create the folder if it does not exist).
    4. Restart Home Assistant.

After Home Assistant comes back online, continue with the **Configuration** section below.

---

## üîß  Configuration

The integration supports **UI configuration** (Config-Flow) **and** classic YAML.  Unless you have a specific reason, use the UI ‚Äì it keeps secrets out of your repo and allows on-the-fly edits.

### 1.  UI / Config-Flow (recommended)

1. Go to *Settings ‚Üí Devices & Services*.
2. Click **+ Add Integration** and search for **Emby**.
3. Enter the base URL of your Emby server, choose the protocol and supply an **API key** (generate under *Emby ‚Üí Settings ‚Üí API Keys*).
4. Select the libraries you wish to expose (optional ‚Äì defaults to all).

That‚Äôs it!  New `media_player` entities will appear the next time an Emby client connects.

### 2.  YAML (advanced / headless installs)

```yaml
media_player:
  - platform: embymedia
    host: 192.168.1.50        # IP or hostname of your Emby server
    api_key: ABCDEF123456789  # Generated on the Emby server

    # Optional parameters
    port: 8096               # Default 8096 (HTTP) / 8920 (HTTPS)
    ssl: false               # Set true if the server URL is HTTPS
    timeout: 30              # Connection timeout in seconds (default 10)
```

Reload the `media_player` platform or restart Home Assistant for the changes to take effect.

#### Configuration parameters

| Key       | Required | Default | Description                                                |
|-----------|----------|---------|------------------------------------------------------------|
| `host`    | ‚úî (UI) / YAML | `localhost` | IP address or hostname of your Emby server.               |
| `api_key` | ‚úî        | ‚Äì       | Emby **API key** generated under *Server ‚Üí Security ‚Üí API Keys*. |
| `port`    | ‚úñ        | `8096` (HTTP) / `8920` (HTTPS) | Override the listening port when you have changed Emby‚Äôs defaults. |
| `ssl`     | ‚úñ        | `false` | Set `true` when the **base URL** you enter is HTTPS.       |
| `timeout` | ‚úñ        | `10`    | Connection timeout in **seconds** during setup.            |

Parameters are identical between the UI flow and YAML ‚Äì pick whichever method
fits your deployment.

---

## ‚ñ∂Ô∏è  Playing Media & Building Automations

Home Assistant‚Äôs standard `media_player.play_media` service is fully implemented.  Every tile in the browse dialog can be dropped straight into a service call and you can target one or many players.

| Key          | Required | Type               | Description                                                                                 |
|--------------|----------|--------------------|---------------------------------------------------------------------------------------------|
| `media_type` | ‚úî        | string             | `movie`, `episode`, `music`, `playlist`, `channel`, `trailer`                                |
| `media_id`   | ‚úî        | string             | Title, Emby *ItemId* or a deep-link like `emby://item/1234abcd`                              |
| `enqueue`    | ‚úñ        | string &#124; bool | `"play"`, `"next"`, `"add"` (or legacy `true`/`false`)                                       |
| `announce`   | ‚úñ        | bool               | Play without interrupting existing content, where the client supports it                    |
| `position`   | ‚úñ        | integer            | Start position in **seconds**                                                               |

### Example ‚Äì play a movie immediately

```yaml
service: media_player.play_media
target:
  entity_id: media_player.emby_living_room_tv
data:
  media_type: movie
  media_id: "Back to the Future (1985)"
```

### Example ‚Äì queue the next episode of a show

```yaml
service: media_player.play_media
target:
  entity_id: media_player.emby_living_room_tv
data:
  media_type: episode
  media_id: "S02E05"   # Title fragments also work (e.g. "Lost S02E05")
  enqueue: next
```

### Example ‚Äì resume music 30 seconds in

```yaml
service: media_player.play_media
target:
  entity_id: media_player.emby_audio_zone
data:
  media_type: music
  media_id: "Bohemian Rhapsody"
  position: 30
```

### Automation snippet

```yaml
alias: "Play welcome song when I arrive home"
trigger:
  - platform: state
    entity_id: person.matt
    to: home
action:
  - service: media_player.play_media
    target:
      entity_id: media_player.emby_kitchen_display
    data:
      media_type: music
      media_id: "Here Comes the Sun"
```

Need to debug the resolver?  Increase the log level:

```yaml
logger:
  default: info
  logs:
    custom_components.embymedia: debug
```

---

## üñº  Browsing Your Library

1. Open *Media ‚Üí Browse media* (or click the üéµ icon when creating an Automation).
2. Choose an Emby player to browse through.
3. Navigate Libraries ‚Üí Collections/Seasons ‚Üí Items.  Leaf items start playback immediately, folders open deeper levels.

The dialog automatically pages large libraries for speed.  *Next* / *Previous* folders are injected when required so you can step through thousands of items without freezing the UI.

Any leaf tile can be dragged into a script or automation; it will populate the `media_type` and `media_id` fields for you.

---

## üßë‚Äçüíª  Contributing

Bug reports, feature requests and pull-requests are very welcome.  Please open an issue or discussion first for anything non-trivial so we can co-ordinate work.

The repository includes a full test-suite (**pytest**) and strict static type checking (**Pyright**).  CI must pass before a PR can be merged.

```bash
# run tests
pytest -q

# static type checking
pip install pyright
pyright --stats
```

---

## üìú  License

Released under the MIT License ‚Äì see the `LICENSE` file for details.
